"use strict";(self["webpackChunkthedaoscapefrontend"]=self["webpackChunkthedaoscapefrontend"]||[]).push([[886],{70477:(e,t,o)=>{o.r(t),o.d(t,{default:()=>xe});var a=o(34182);const n=(0,a.createElementVNode)("div",{style:{height:"60vh"}},null,-1);function c(e,t,o,c,s,r){const i=(0,a.resolveComponent)("newGroup"),l=(0,a.resolveComponent)("q-page");return(0,a.openBlock)(),(0,a.createBlock)(l,{padding:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(i,{class:"q-mt-lg",prefill:{group_account_name:e.$route.params.newgroupname}},null,8,["prefill"]),n])),_:1})}var s=o(55250);const r={class:"row justify-center"},i={class:"create-group-width"},l=(0,a.createElementVNode)("p",{class:"text-h4 q-mt-lg"},"Create Your DAO",-1),u={class:"q-mb-md text-grey-5 text-h6 text-weight-light"},m={key:0,class:"row justify-between"},d=(0,a.createElementVNode)("div",null,"CREATING A DAO",-1),p=[d],h={key:1,class:"row justify-between"},g=(0,a.createElementVNode)("div",null,"CHOOSE YOUR GROUP NAME",-1),_={key:2,class:"row justify-between"},b=(0,a.createElementVNode)("div",null,"CREATE ACCOUNT",-1),y={key:3,class:"row justify-between"},N=(0,a.createElementVNode)("div",null,"ACTIVATE DAO",-1),w={key:4,class:"row justify-between"},v=(0,a.createElementVNode)("div",null,"CREATING",-1),f={class:"text-uppercase text-primary"},V=(0,a.createElementVNode)("p",{class:"text-subtitle1"},"Things you'll need to get started:",-1),C=(0,a.createElementVNode)("li",null,[(0,a.createElementVNode)("b",null,"DAO Account Name:"),(0,a.createTextVNode)(" Choose your DAO account name, based on the normal Proton name restrictions (a-z, 1-5, min 4 characters, max 12 characters). Once the DAO has been setup, the account name cannot be changed.")],-1),k=(0,a.createElementVNode)("b",null,"XPR Ready:",-1),x={key:0,class:"text-white text-center bg-secondary q-pa-md rounded-borders"},E=(0,a.createElementVNode)("p",{class:"text-h6 text-center"},"Please login with Anchor",-1),A=(0,a.createElementVNode)("p",{class:"text-center"},[(0,a.createTextVNode)("In order to create a DAO, you must login in Anchor and ensure that "),(0,a.createElementVNode)("br"),(0,a.createElementVNode)("b",null,'"Create a session for future use with this app"'),(0,a.createElementVNode)("br"),(0,a.createTextVNode)(" is selected. ")],-1),q={key:1,class:"row justify-center"},B={class:"rounded-borders overflow-hidden"},D={key:0,class:"text-grey-8 row"},T=(0,a.createElementVNode)("span",null,"Account name available!",-1),R=[T],S={key:1},$=(0,a.createElementVNode)("p",{class:"q-mt-md text-grey-6"},[(0,a.createElementVNode)("em",null,"Please note: the group name cannot be changed once it has been created.")],-1),O={class:"column justify-center items-center q-mt-lg"},P={key:0,class:"q-mt-sm"},G=(0,a.createTextVNode)(" This group isn't activated yet. Proceed to activation by clicking the button. "),Z={class:"row justify-begin items-center text-black"},j={class:"text-uppercase"},H=(0,a.createTextVNode)(" Edit Group Name. "),W={class:"text-subtitle1 q-mb-md"},z={key:0},I={class:"text-grey-6"},Q={key:1,class:"column justify-center items-center q-mt-md"},Y=(0,a.createElementVNode)("p",{class:"text-grey-6"},[(0,a.createTextVNode)(" Good news! You have enough deposits in The DAOScape Hub to create an account."),(0,a.createElementVNode)("br"),(0,a.createTextVNode)(" Clicking the below button will use all your current deposits to create a new DAO account. Excess deposits will be used to buy extra RAM. ")],-1),F={class:"column items-center full-height"},U={class:"text-subtitle1 text-center q-mt-sm"},M=(0,a.createTextVNode)("Your DAO account "),K=(0,a.createTextVNode)(" has been created."),L=(0,a.createElementVNode)("br",null,null,-1),X=(0,a.createTextVNode)("The final step is to activate it!"),J={class:"column items-center full-height text-grey-6 q-pt-md"},ee=(0,a.createElementVNode)("div",{class:"q-mt-md"},"Waiting for Signature",-1),te={class:"column items-center full-height q-pt-md"},oe=(0,a.createElementVNode)("div",{class:"q-mt-sm text-subtitle1"},"Group successfully activated",-1);function ae(e,t,o,n,c,s){const d=(0,a.resolveComponent)("login-network-switcher"),T=(0,a.resolveComponent)("q-btn"),ae=(0,a.resolveComponent)("q-carousel-slide"),ne=(0,a.resolveComponent)("q-icon"),ce=(0,a.resolveComponent)("q-input"),se=(0,a.resolveComponent)("q-tooltip"),re=(0,a.resolveComponent)("hub-deposit-wallet"),ie=(0,a.resolveComponent)("q-spinner"),le=(0,a.resolveComponent)("q-carousel"),ue=(0,a.resolveComponent)("wasmCompiler");return(0,a.openBlock)(),(0,a.createElementBlock)("div",r,[(0,a.createElementVNode)("div",i,[l,(0,a.createElementVNode)("div",u,["intro"===e.step?((0,a.openBlock)(),(0,a.createElementBlock)("div",m,p)):(0,a.createCommentVNode)("",!0),"request_account_name"===e.step?((0,a.openBlock)(),(0,a.createElementBlock)("div",h,[g,(0,a.createElementVNode)("div",null,"1/"+(0,a.toDisplayString)(e.number_of_steps),1)])):(0,a.createCommentVNode)("",!0),"create_account"===e.step?((0,a.openBlock)(),(0,a.createElementBlock)("div",_,[b,(0,a.createElementVNode)("div",null,"2/"+(0,a.toDisplayString)(e.number_of_steps),1)])):(0,a.createCommentVNode)("",!0),"request_activation"===e.step?((0,a.openBlock)(),(0,a.createElementBlock)("div",y,[N,(0,a.createElementVNode)("div",null,"3/"+(0,a.toDisplayString)(e.number_of_steps),1)])):"request_signature"===e.step?((0,a.openBlock)(),(0,a.createElementBlock)("div",w,[v,(0,a.createElementVNode)("div",f,(0,a.toDisplayString)(e.new_group_account_name),1)])):(0,a.createCommentVNode)("",!0)]),(0,a.createVNode)(le,{modelValue:e.step,"onUpdate:modelValue":t[6]||(t[6]=t=>e.step=t),"keep-alive":"",navigation:!1,"transition-prev":"scale","transition-next":"scale",swipeable:!1,animated:"","control-color":"primary",padding:!1,arrows:!1,height:"auto",class:"bg-transparent"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(ae,{name:"intro",class:"no-padding"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",null,[V,(0,a.createElementVNode)("ul",null,[C,(0,a.createElementVNode)("li",null,[k,(0,a.createTextVNode)(" As part of the setup, you'll need to send "+(0,a.toDisplayString)(e.getResourceEstimation)+" to The DAOScape hub account, so be sure to have that ready to go!",1)])]),e.isValidWallet?((0,a.openBlock)(),(0,a.createElementBlock)("div",q,[(0,a.createVNode)(T,{color:"primary",label:"Get Started",onClick:t[0]||(t[0]=t=>e.step="request_account_name")})])):((0,a.openBlock)(),(0,a.createElementBlock)("div",x,[E,A,(0,a.createVNode)(d)]))])])),_:1}),(0,a.createVNode)(ae,{name:"request_account_name",class:"no-padding"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",null,[(0,a.createElementVNode)("div",B,[(0,a.createVNode)(ce,{dark:!1,ref:"accountinput",autocomplete:"off",outlined:"","no-error-icon":"",counter:"",maxlength:"12",color:"accent","bg-color":"white",modelValue:e.new_group_account_name,"onUpdate:modelValue":t[1]||(t[1]=t=>e.new_group_account_name=t),placeholder:"Choose new group name",rules:[e=>!!e||"* Required",e.isValidAccountName,e=>e.length>=4||"Group name must be min 4 chars.",e.isavailableAccountNameWrapper],onInput:t[2]||(t[2]=t=>e.account_name_validated=!1)},{prepend:(0,a.withCtx)((()=>[(0,a.createVNode)(ne,{name:"people"})])),append:(0,a.withCtx)((()=>[e.account_name_validated?((0,a.openBlock)(),(0,a.createBlock)(ne,{key:0,name:"check",color:"positive"})):(0,a.createCommentVNode)("",!0)])),hint:(0,a.withCtx)((()=>[e.account_name_validated?((0,a.openBlock)(),(0,a.createElementBlock)("span",D,R)):((0,a.openBlock)(),(0,a.createElementBlock)("span",S,"12 char account name"))])),_:1},8,["modelValue","rules"]),$]),(0,a.createElementVNode)("div",O,[(0,a.createVNode)(T,{color:"primary",label:"next",style:{width:"150px"},disabled:!e.account_name_validated,onClick:t[3]||(t[3]=t=>e.next(""))},null,8,["disabled"]),e.groups_by_creator.length?((0,a.openBlock)(),(0,a.createElementBlock)("div",P,[(0,a.createVNode)(a.TransitionGroup,{appear:"","enter-active-class":"animated zoomIn","leave-active-class":"animated zoomOut",mode:"out-in",class:"column q-gutter-sm",tag:"div"},{default:(0,a.withCtx)((()=>[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.groups_by_creator.filter((e=>0===e.state)),(t=>((0,a.openBlock)(),(0,a.createBlock)(T,{icon:"mdi-alert",label:t.groupname,key:t.groupname,color:"secondary",onClick:o=>e.next(t.groupname)},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(se,{class:"bg-secondary",delay:500},{default:(0,a.withCtx)((()=>[G])),_:1})])),_:2},1032,["label","onClick"])))),128))])),_:1})])):(0,a.createCommentVNode)("",!0)])])])),_:1}),(0,a.createVNode)(ae,{name:"create_account",class:"no-padding"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",Z,[(0,a.createElementVNode)("span",j,(0,a.toDisplayString)(e.new_group_account_name),1),(0,a.createVNode)(T,{icon:"edit",round:"",flat:"",size:"sm",onClick:t[4]||(t[4]=t=>e.step="request_account_name")},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(se,{delay:300,anchor:"center right",self:"center left",offset:[10,0]},{default:(0,a.withCtx)((()=>[H])),_:1})])),_:1})]),(0,a.createElementVNode)("p",W," The estimated cost to create your DAO account is "+(0,a.toDisplayString)(e.getResourceEstimation)+". ",1),e.has_enough_deposits?(0,a.createCommentVNode)("",!0):((0,a.openBlock)(),(0,a.createElementBlock)("div",z,[(0,a.createElementVNode)("p",I," You don't have enough "+(0,a.toDisplayString)(e.getAppConfig.system_token.symbol)+" deposits to start your DAO. Please make a deposit below. You need a minimum of "+(0,a.toDisplayString)(e.getResourceEstimation)+" to deploy the core contract. Excess deposits will be used to buy extra RAM. ",1),(0,a.createVNode)(re,{default_input_value:e.getRamPricePerByte*e.required_bytes},null,8,["default_input_value"])])),e.has_enough_deposits?((0,a.openBlock)(),(0,a.createElementBlock)("div",Q,[Y,(0,a.createVNode)(T,{color:"primary",label:"Create Account",disabled:!e.account_name_validated,onClick:e.createGroup},null,8,["disabled","onClick"])])):(0,a.createCommentVNode)("",!0)])),_:1}),(0,a.createVNode)(ae,{name:"request_activation",class:"no-padding"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",F,[(0,a.createElementVNode)("p",U,[M,(0,a.createElementVNode)("b",null,(0,a.toDisplayString)(this.new_group_account_name),1),K,L,X]),(0,a.createVNode)(T,{color:"primary",label:"activate",style:{width:"150px"},onClick:e.activateGroup},null,8,["onClick"])])])),_:1}),(0,a.createVNode)(ae,{name:"request_signature",class:"no-padding"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",J,[(0,a.createVNode)(ie,{color:"primary",size:"40px",onClick:t[5]||(t[5]=t=>e.step="request_account_name"),class:"cursor-pointer"}),ee])])),_:1}),(0,a.createVNode)(ae,{name:"group_created",class:"no-padding"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",te,[(0,a.createVNode)(ne,{name:"mdi-check-circle-outline",color:"primary",size:"52px"}),oe,(0,a.createVNode)(T,{label:"visit group",color:"primary",class:"q-mt-md",to:`/manage/${e.new_group_account_name}`},null,8,["to"])])])),_:1})])),_:1},8,["modelValue"])]),(0,a.createVNode)(ue,{ref:"wasm_compiler"},null,512)])}o(10071);var ne=o(45139),ce=o(44494),se=o(97348),re=o(47592),ie=o(72663),le=o(40019);const ue=(0,a.defineComponent)({name:"newGroup",components:{wasmCompiler:ne.Z,loginNetworkSwitcher:ce.Z,hubDepositWallet:se.Z},props:{prefill:{type:Object,default:()=>({group_account_name:""})}},data(){return{number_of_steps:3,step:"intro",new_group_account_name:"",account_name_validated:!1,voice_only:!1,wasmhex:"",abihex:"",groups_by_creator:[],required_bytes:192e4}},computed:{...(0,s.Se)({getAccountName:"proton/getAccountName",getAppConfig:"app/getAppConfig",getHubDeposits:"user/getHubDeposits",getRamPricePerByte:"app/getRamPricePerByte",getSession:"proton/getSession"}),getResourceEstimation(){if(this.getRamPricePerByte)return`${(this.getRamPricePerByte*this.required_bytes).toFixed(4)} ${this.getAppConfig.system_token.symbol}`},has_enough_deposits(){let e=!1;if(this.getResourceEstimation&&this.getHubDeposits.length){let e=this.getHubDeposits.find((e=>e.symbol==this.getAppConfig.system_token.symbol)).quantity;if(e)return parseFloat(this.getResourceEstimation)<=parseFloat(e)}return e},hubDeposits(){return this.getHubDeposits.length?`${this.getHubDeposits.find((e=>e.symbol==this.getAppConfig.system_token.symbol)).quantity}`:`0 ${this.getAppConfig.system_token.symbol}`},isValidWallet(){return!!this.getSession&&("anchor"==this.getSession.link.walletType&&"channel"==this.getSession.type)},isWebAuth(){return!!this.getSession&&"proton"==this.getSession.link.walletType}},async mounted(){this.$store.dispatch("app/fetchRamPricePerByte",{vm:this}),await this.get_wasm_and_abi_from_github(),this.prefill.group_account_name&&(this.new_group_account_name=this.prefill.group_account_name)},watch:{getAccountName:{immediate:!0,handler:function(e,t){this.getAccountName&&this.getGroupsByCreator()}}},methods:{isValidAccountName:re.ZF,isAvailableAccountName:re.Kx,async isavailableAccountNameWrapper(e){const t=await(0,re.Kx)({v:e,vm:this});return!0===t?(this.account_name_validated=!0,!0):(this.account_name_validated=!1,t)},async activateGroup(){this.deploycontract(this.new_group_account_name)},async createGroup(){try{await this.$store.dispatch("app/fetchRamPricePerByte",{vm:this}),this.step="request_signature";let e={account:this.getAppConfig.groups_contract,name:"creategroup",data:{groupname:this.new_group_account_name,creator:this.getAccountName,resource_estimation:this.getResourceEstimation}},t=await this.$store.dispatch("proton/transact",{actions:[e],disable_signing_overlay:!0});if(setTimeout((()=>{this.$store.dispatch("user/fetchHubDeposits",{accountname:this.getAccountName,vm:this})}),2e3),!t||!t.trxid)return this.step="create_account",!1;(0,ie.t5)({message:`"${this.new_group_account_name}" has been created.`}),this.step="request_activation"}catch(e){le.warn(e)}},async deploycontract(e){this.step="request_signature";let t={account:"eosio",name:"setcode",data:{account:e,vmtype:0,vmversion:0,code:this.wasmhex},authorization:[{actor:this.getAccountName,permission:"active"},{actor:e,permission:"active"}]},o={account:"eosio",name:"setabi",data:{account:e,abi:this.abihex},authorization:[{actor:this.getAccountName,permission:"active"},{actor:e,permission:"active"}]},a={account:this.getAppConfig.groups_contract,name:"activate",data:{groupname:e,creator:this.getAccountName}},n=await this.$store.dispatch("proton/transact",{actions:[o,t,a],disable_signing_overlay:!0});return setTimeout((()=>{this.$store.dispatch("user/fetchHubDeposits",{accountname:this.getAccountName,vm:this})}),1e3),n&&n.trxid?((0,ie.t5)({message:`"${this.new_group_account_name}" has been activated.`}),this.step="group_created",!0):(this.step="request_activation",!1)},openHubWallet(){let e=`You don't have enough ${this.getAppConfig.system_token.symbol} deposits to start your DAO.\n      You need a minimum of ${this.getResourceEstimation} to deploy the core contract. Excess deposits will be used to buy extra RAM.\n      Once you have deposited the required amount, please close this pop-up and click "Create Account" again.`;this.emitter.emit("showHubDeposits",e)},async next(e=""){""!=e?(this.step="request_activation",this.new_group_account_name=e,this.account_name_validated=!0):this.step="create_account"},async get_wasm_and_abi_from_github(){le.log("retrieving code from github");let e=await this.$refs.wasm_compiler.loadRemoteWasm(`${this.getAppConfig.core_contract.raw}${this.getAppConfig.core_contract.wasm}`),t=await this.$refs.wasm_compiler.loadRemoteAbi(`${this.getAppConfig.core_contract.raw}${this.getAppConfig.core_contract.abi}`);this.wasmhex=e.wasm,this.abihex=t.abi},async get_wasm_and_abi_from_block(e){let t=[];t.push(this.$eos.api.rpc.get_block(e.wasm[0])),e.wasm[0]!=e.abi[0]&&t.push(this.$eos.api.rpc.get_block(e.abi[0]));let[o,a]=await Promise.all(t);a=a||o;let n=o.transactions.find((t=>t.trx.id==e.wasm[1])).trx.transaction.actions.find((e=>"setcode"==e.name)).data.code,c=a.transactions.find((t=>t.trx.id==e.abi[1])).trx.transaction.actions.find((e=>"setabi"==e.name)).data.abi;this.wasmhex=n,this.abihex=c},async getGroupsByCreator(){let e=await this.$eos.api.rpc.get_table_rows({json:!0,code:this.getAppConfig.groups_contract,scope:this.getAppConfig.groups_contract,table:"groups",key_type:"name",index_position:3,lower_bound:this.getAccountName,upper_bound:this.getAccountName,limit:-1});e=e&&e.rows.length&&e.rows[0].creator==this.getAccountName?e.rows:[],le.log("fetched groups by creator",e),this.groups_by_creator=e}}});var me=o(74260),de=o(31277),pe=o(34593),he=o(2165),ge=o(64689),_e=o(24554),be=o(5363),ye=o(6833),Ne=o(7518),we=o.n(Ne);const ve=(0,me.Z)(ue,[["render",ae]]),fe=ve;we()(ue,"components",{QCarousel:de.Z,QCarouselSlide:pe.Z,QBtn:he.Z,QInput:ge.Z,QIcon:_e.Z,QTooltip:be.Z,QSpinner:ye.Z});const Ve=(0,a.defineComponent)({name:"create",components:{newGroup:fe},data(){return{}},computed:{...(0,s.Se)({getAccountName:"proton/getAccountName"})},methods:{},watch:{}});var Ce=o(24379);const ke=(0,me.Z)(Ve,[["render",c]]),xe=ke;we()(Ve,"components",{QPage:Ce.Z})}}]);