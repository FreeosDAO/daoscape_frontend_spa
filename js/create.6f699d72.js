"use strict";(self["webpackChunkthedaoscapefrontend"]=self["webpackChunkthedaoscapefrontend"]||[]).push([[886],{13838:(e,t,o)=>{o.r(t),o.d(t,{default:()=>we});var a=o(34182);const n=(0,a.createElementVNode)("div",{style:{height:"60vh"}},null,-1);function s(e,t,o,s,c,r){const i=(0,a.resolveComponent)("scrolling-background"),l=(0,a.resolveComponent)("newGroup"),u=(0,a.resolveComponent)("q-page");return(0,a.openBlock)(),(0,a.createBlock)(u,{padding:"",class:"bg-white"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(i,{class:"absolute-bottom"}),(0,a.createVNode)(l,{class:"q-mt-lg",prefill:{group_account_name:e.$route.params.newgroupname}},null,8,["prefill"]),n])),_:1})}var c=o(10741);const r={class:"scrolling-bg-container"},i=(0,a.createElementVNode)("div",{class:"sliding-background-image"},null,-1),l=[i];function u(e,t,o,n,s,c){return(0,a.openBlock)(),(0,a.createElementBlock)("div",r,l)}const d=(0,a.defineComponent)({data(){return{}}});var m=o(74260);const p=(0,m.Z)(d,[["render",u]]),h=p,g={class:"row justify-center"},_={class:"create-group-width"},b={class:"q-mb-md text-grey-5 text-h6 text-weight-light"},y={key:0,class:"row justify-between"},f=(0,a.createElementVNode)("div",null,"CREATING A DAO",-1),v=[f],w={key:1,class:"row justify-between"},N=(0,a.createElementVNode)("div",null,"CHOOSE YOUR GROUP NAME",-1),V={key:2,class:"row justify-between"},k=(0,a.createElementVNode)("div",null,"CREATE ACCOUNT",-1),C={key:3,class:"row justify-between"},x=(0,a.createElementVNode)("div",null,"CREATING",-1),E={class:"text-uppercase text-primary"},A=(0,a.createElementVNode)("p",{class:"text-h4"},"Create Your DAO",-1),q=(0,a.createElementVNode)("p",{class:"text-subtitle1"},"Things you'll need to get started:",-1),B=(0,a.createElementVNode)("li",null,[(0,a.createElementVNode)("b",null,"DAO Account Name:"),(0,a.createTextVNode)(" Choose your DAO account name, based on the normal Proton name restrictions (a-z, 1-5, min 4 characters). Once the DAO has been setup, the account name cannot be changed.")],-1),D=(0,a.createElementVNode)("b",null,"XPR Ready:",-1),R={key:0,class:"text-white text-center bg-secondary q-pa-md rounded-borders"},S=(0,a.createElementVNode)("p",{class:"text-h6 text-center"},"Please login with Anchor",-1),T=(0,a.createElementVNode)("p",{class:"text-center"},[(0,a.createTextVNode)("In order to create a DAO, you must login in Anchor and ensure that "),(0,a.createElementVNode)("br"),(0,a.createElementVNode)("b",null,'"Create a session for future use with this app"'),(0,a.createElementVNode)("br"),(0,a.createTextVNode)(" is selected. ")],-1),O={key:1,class:"row justify-center"},$={class:"rounded-borders overflow-hidden"},P={key:0,class:"text-grey-8 row"},G=(0,a.createElementVNode)("span",null,"Account name available!",-1),Z=[G],H={key:1},j={class:"column justify-center items-center q-mt-lg"},W={key:0,class:"q-mt-sm"},z=(0,a.createTextVNode)(" This group isn't activated yet. Proceed to activation by clicking the button. "),Q={class:"row justify-begin items-center text-black"},F={class:"text-uppercase"},I=(0,a.createTextVNode)(" Edit Group Name. "),U={class:"text-grey-6"},Y={class:"column justify-center items-center q-mt-md"},K={class:"column items-center full-height text-grey-6 q-pt-md"},M=(0,a.createTextVNode)(" Account created "),L={class:"column items-center full-height text-grey-6 q-pt-md"},X=(0,a.createElementVNode)("div",{class:"q-mt-md"},"Waiting for Signature",-1),J={class:"column items-center full-height text-grey-6 q-pt-md"},ee=(0,a.createElementVNode)("div",{class:"q-mt-xs"},"Group created successful",-1);function te(e,t,o,n,s,c){const r=(0,a.resolveComponent)("login-network-switcher"),i=(0,a.resolveComponent)("q-btn"),l=(0,a.resolveComponent)("q-carousel-slide"),u=(0,a.resolveComponent)("q-icon"),d=(0,a.resolveComponent)("q-input"),m=(0,a.resolveComponent)("q-tooltip"),p=(0,a.resolveComponent)("q-spinner"),h=(0,a.resolveComponent)("q-carousel"),f=(0,a.resolveComponent)("wasmCompiler");return(0,a.openBlock)(),(0,a.createElementBlock)("div",g,[(0,a.createElementVNode)("div",_,[(0,a.createElementVNode)("div",b,["intro"===e.step?((0,a.openBlock)(),(0,a.createElementBlock)("div",y,v)):(0,a.createCommentVNode)("",!0),"request_account_name"===e.step?((0,a.openBlock)(),(0,a.createElementBlock)("div",w,[N,(0,a.createElementVNode)("div",null,"1/"+(0,a.toDisplayString)(e.number_of_steps),1)])):(0,a.createCommentVNode)("",!0),"create_account"===e.step?((0,a.openBlock)(),(0,a.createElementBlock)("div",V,[k,(0,a.createElementVNode)("div",null,"2/"+(0,a.toDisplayString)(e.number_of_steps),1)])):"request_signature"===e.step?((0,a.openBlock)(),(0,a.createElementBlock)("div",C,[x,(0,a.createElementVNode)("div",E,(0,a.toDisplayString)(e.new_group_account_name),1)])):(0,a.createCommentVNode)("",!0)]),(0,a.createVNode)(h,{modelValue:e.step,"onUpdate:modelValue":t[6]||(t[6]=t=>e.step=t),"keep-alive":"",navigation:!1,"transition-prev":"scale","transition-next":"scale",swipeable:!1,animated:"","control-color":"primary",padding:!1,arrows:!1,height:"auto",class:"bg-transparent"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(l,{name:"info",class:"no-padding"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",null,[A,q,(0,a.createElementVNode)("ul",null,[B,(0,a.createElementVNode)("li",null,[D,(0,a.createTextVNode)(" As part of the setup, you'll need to send "+(0,a.toDisplayString)(e.getResourceEstimation)+" to The DAOScape hub account, so be sure to have that ready to go!",1)])]),e.isValidWallet?((0,a.openBlock)(),(0,a.createElementBlock)("div",O,[(0,a.createVNode)(i,{color:"primary",label:"Get Started",onClick:t[0]||(t[0]=t=>e.step="request_account_name")})])):((0,a.openBlock)(),(0,a.createElementBlock)("div",R,[S,T,(0,a.createVNode)(r)]))])])),_:1}),(0,a.createVNode)(l,{name:"request_account_name",class:"no-padding"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",null,[(0,a.createElementVNode)("div",$,[(0,a.createVNode)(d,{dark:!1,ref:"accountinput",autocomplete:"off",outlined:"","no-error-icon":"",counter:"",maxlength:"12",color:"accent","bg-color":"white",modelValue:e.new_group_account_name,"onUpdate:modelValue":t[1]||(t[1]=t=>e.new_group_account_name=t),placeholder:"Choose new group name",rules:[e=>!!e||"* Required",e.isValidAccountName,e=>e.length>=4||"Group name must be min 4 chars.",e.isavailableAccountNameWrapper],onInput:t[2]||(t[2]=t=>e.account_name_validated=!1)},{prepend:(0,a.withCtx)((()=>[(0,a.createVNode)(u,{name:"people"})])),append:(0,a.withCtx)((()=>[e.account_name_validated?((0,a.openBlock)(),(0,a.createBlock)(u,{key:0,name:"check",color:"positive"})):(0,a.createCommentVNode)("",!0)])),hint:(0,a.withCtx)((()=>[e.account_name_validated?((0,a.openBlock)(),(0,a.createElementBlock)("span",P,Z)):((0,a.openBlock)(),(0,a.createElementBlock)("span",H,"12 char account name"))])),_:1},8,["modelValue","rules"])]),(0,a.createElementVNode)("div",j,[(0,a.createVNode)(i,{color:"primary",label:"next",style:{width:"150px"},disabled:!e.account_name_validated,onClick:t[3]||(t[3]=t=>e.next(""))},null,8,["disabled"]),e.groups_by_creator.length?((0,a.openBlock)(),(0,a.createElementBlock)("div",W,[(0,a.createVNode)(a.TransitionGroup,{appear:"","enter-active-class":"animated zoomIn","leave-active-class":"animated zoomOut",mode:"out-in",class:"column q-gutter-sm",tag:"div"},{default:(0,a.withCtx)((()=>[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.groups_by_creator.filter((e=>0===e.state)),(t=>((0,a.openBlock)(),(0,a.createBlock)(i,{icon:"mdi-alert",label:t.groupname,key:t.groupname,color:"secondary",onClick:o=>e.next(t.groupname)},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(m,{class:"bg-secondary",delay:500},{default:(0,a.withCtx)((()=>[z])),_:1})])),_:2},1032,["label","onClick"])))),128))])),_:1})])):(0,a.createCommentVNode)("",!0)])])])),_:1}),(0,a.createVNode)(l,{name:"create_account",class:"no-padding"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",Q,[(0,a.createElementVNode)("span",F,(0,a.toDisplayString)(e.new_group_account_name),1),(0,a.createVNode)(i,{icon:"edit",round:"",flat:"",size:"sm",onClick:t[4]||(t[4]=t=>e.step="request_account_name")},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(m,{delay:300,anchor:"center right",self:"center left",offset:[10,0]},{default:(0,a.withCtx)((()=>[I])),_:1})])),_:1})]),(0,a.createElementVNode)("div",U," The estimated cost to create your account is "+(0,a.toDisplayString)(e.getResourceEstimation)+". Your current DAOScape balance is: "+(0,a.toDisplayString)(e.hubDeposits)+". ",1),(0,a.createElementVNode)("div",Y,[(0,a.createVNode)(i,{color:"primary",label:"Create Account",style:{width:"150px"},disabled:!e.account_name_validated,onClick:e.createGroup},null,8,["disabled","onClick"])])])),_:1}),(0,a.createVNode)(l,{name:"request_activation",class:"no-padding"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",K,[M,(0,a.createVNode)(i,{color:"primary",label:"activate",style:{width:"150px"},onClick:e.activateGroup},null,8,["onClick"])])])),_:1}),(0,a.createVNode)(l,{name:"request_signature",class:"no-padding"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",L,[(0,a.createVNode)(p,{color:"primary",size:"40px",onClick:t[5]||(t[5]=t=>e.step="request_account_name"),class:"cursor-pointer"}),X])])),_:1}),(0,a.createVNode)(l,{name:"group_created",class:"no-padding"},{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",J,[(0,a.createVNode)(u,{color:"primary",size:"40px",name:"check"}),ee,(0,a.createVNode)(i,{label:"visit group",color:"secondary",class:"q-mt-md",to:`/manage/${e.new_group_account_name}`},null,8,["to"])])])),_:1})])),_:1},8,["modelValue"])]),(0,a.createVNode)(f,{ref:"wasm_compiler"},null,512)])}o(10071);var oe=o(48860),ae=o(44494),ne=o(47592),se=o(40019);const ce=(0,a.defineComponent)({name:"newGroup",components:{wasmCompiler:oe.Z,loginNetworkSwitcher:ae.Z},props:{prefill:{type:Object,default:()=>({group_account_name:""})}},data(){return{number_of_steps:3,step:"info",new_group_account_name:"",account_name_validated:!1,voice_only:!1,wasmhex:"",abihex:"",groups_by_creator:[],required_bytes:192e4}},computed:{...(0,c.Se)({getAccountName:"proton/getAccountName",getAppConfig:"app/getAppConfig",getHubDeposits:"user/getHubDeposits",getRamPricePerByte:"app/getRamPricePerByte",getSession:"proton/getSession"}),getResourceEstimation(){if(this.getRamPricePerByte)return`${(this.getRamPricePerByte*this.required_bytes).toFixed(4)} ${this.getAppConfig.system_token.symbol}`},has_enough_deposits(){let e=!1;if(this.getResourceEstimation&&this.getHubDeposits.length){let e=this.getHubDeposits.find((e=>e.symbol==this.getAppConfig.system_token.symbol)).quantity;if(e)return parseFloat(this.getResourceEstimation)<=parseFloat(e)}return e},hubDeposits(){return this.getHubDeposits.length?`${this.getHubDeposits.find((e=>e.symbol==this.getAppConfig.system_token.symbol)).quantity}`:`0 ${this.getAppConfig.system_token.symbol}`},isValidWallet(){return!!this.getSession&&("anchor"==this.getSession.link.walletType&&"channel"==this.getSession.type)},isWebAuth(){return!!this.getSession&&"proton"==this.getSession.link.walletType}},async mounted(){this.$store.dispatch("app/fetchRamPricePerByte",{vm:this}),await this.get_wasm_and_abi_from_github(),this.prefill.group_account_name&&(this.new_group_account_name=this.prefill.group_account_name)},watch:{new_group_account_name:function(){se.log(this.$refs.accountinput.hasError)},getAccountName:{immediate:!0,handler:function(e,t){this.getAccountName&&this.getGroupsByCreator()}}},methods:{isValidAccountName:ne.ZF,isAvailableAccountName:ne.Kx,async isavailableAccountNameWrapper(e){const t=await(0,ne.Kx)({v:e,vm:this});return!0===t?(this.account_name_validated=!0,!0):(this.account_name_validated=!1,t)},async activateGroup(){this.deploycontract(this.new_group_account_name)},async createGroup(){if(this.has_enough_deposits)try{await this.$store.dispatch("app/fetchRamPricePerByte",{vm:this}),this.step="request_signature";let e={account:this.getAppConfig.groups_contract,name:"creategroup",data:{groupname:this.new_group_account_name,creator:this.getAccountName,resource_estimation:this.getResourceEstimation}},t=await this.$store.dispatch("proton/transact",{actions:[e],disable_signing_overlay:!0});if(setTimeout((()=>{this.$store.dispatch("user/fetchHubDeposits",{accountname:this.getAccountName,vm:this})}),2e3),!t||!t.trxid)return this.step="create_account",!1;this.step="request_activation"}catch(e){se.warn(e)}else this.openHubWallet()},async deploycontract(e){this.step="request_signature";let t={account:"eosio",name:"setcode",data:{account:e,vmtype:0,vmversion:0,code:this.wasmhex},authorization:[{actor:this.getAccountName,permission:"active"},{actor:e,permission:"active"}]},o={account:"eosio",name:"setabi",data:{account:e,abi:this.abihex},authorization:[{actor:this.getAccountName,permission:"active"},{actor:e,permission:"active"}]},a={account:this.getAppConfig.groups_contract,name:"activate",data:{groupname:e,creator:this.getAccountName}},n=await this.$store.dispatch("proton/transact",{actions:[o,t,a],disable_signing_overlay:!0});return setTimeout((()=>{this.$store.dispatch("user/fetchHubDeposits",{accountname:this.getAccountName,vm:this})}),1e3),n&&n.trxid?(this.step="group_created",!0):(this.step="request_activation",!1)},openHubWallet(){let e=`You don't have enough ${this.getAppConfig.system_token.symbol} deposits to start your DAO.\n      You need a minimum of ${this.getResourceEstimation} to deploy the core contract. Excess deposits will be used to buy extra RAM.\n      Once you have deposited the required amount, please close this pop-up and click "Create Account" again.`;this.emitter.emit("showHubDeposits",e)},async next(e=""){""!=e?(this.step="request_activation",this.new_group_account_name=e,this.account_name_validated=!0):(this.step="create_account",this.has_enough_deposits||this.openHubWallet())},async get_wasm_and_abi_from_github(){se.log("retrieving code from github");let e=await this.$refs.wasm_compiler.loadRemoteWasm("https://raw.githubusercontent.com/FreeosDAO/daclifycore/master/daclifycore.wasm"),t=await this.$refs.wasm_compiler.loadRemoteAbi("https://raw.githubusercontent.com/FreeosDAO/daclifycore/master/daclifycore.abi");this.wasmhex=e.wasm,this.abihex=t.abi},async get_wasm_and_abi_from_block(e){let t=[];t.push(this.$eos.api.rpc.get_block(e.wasm[0])),e.wasm[0]!=e.abi[0]&&t.push(this.$eos.api.rpc.get_block(e.abi[0]));let[o,a]=await Promise.all(t);a=a||o;let n=o.transactions.find((t=>t.trx.id==e.wasm[1])).trx.transaction.actions.find((e=>"setcode"==e.name)).data.code,s=a.transactions.find((t=>t.trx.id==e.abi[1])).trx.transaction.actions.find((e=>"setabi"==e.name)).data.abi;this.wasmhex=n,this.abihex=s},async getGroupsByCreator(){let e=await this.$eos.api.rpc.get_table_rows({json:!0,code:this.getAppConfig.groups_contract,scope:this.getAppConfig.groups_contract,table:"groups",key_type:"name",index_position:3,lower_bound:this.getAccountName,upper_bound:this.getAccountName,limit:-1});e=e&&e.rows.length&&e.rows[0].creator==this.getAccountName?e.rows:[],se.log("fetched groups by creator",e),this.groups_by_creator=e}}});var re=o(31277),ie=o(34593),le=o(2165),ue=o(64689),de=o(24554),me=o(5363),pe=o(6833),he=o(7518),ge=o.n(he);const _e=(0,m.Z)(ce,[["render",te]]),be=_e;ge()(ce,"components",{QCarousel:re.Z,QCarouselSlide:ie.Z,QBtn:le.Z,QInput:ue.Z,QIcon:de.Z,QTooltip:me.Z,QSpinner:pe.Z});const ye=(0,a.defineComponent)({name:"create",components:{newGroup:be,scrollingBackground:h},data(){return{}},computed:{...(0,c.Se)({getAccountName:"proton/getAccountName"})},methods:{},watch:{}});var fe=o(24379);const ve=(0,m.Z)(ye,[["render",s]]),we=ve;ge()(ye,"components",{QPage:fe.Z})}}]);