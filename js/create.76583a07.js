"use strict";(self["webpackChunkthedaoscapefrontend"]=self["webpackChunkthedaoscapefrontend"]||[]).push([[886],{44187:(e,t,a)=>{a.r(t),a.d(t,{default:()=>he});var o=a(34182);const n=(0,o.createElementVNode)("div",{style:{height:"60vh"}},null,-1);function s(e,t,a,s,c,r){const i=(0,o.resolveComponent)("newGroup"),l=(0,o.resolveComponent)("q-page");return(0,o.openBlock)(),(0,o.createBlock)(l,{padding:"",class:"bg-white"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(i,{class:"q-mt-lg",prefill:{group_account_name:e.$route.params.newgroupname}},null,8,["prefill"]),n])),_:1})}var c=a(55250);const r={class:"row justify-center"},i={class:"create-group-width"},l=(0,o.createElementVNode)("p",{class:"text-h4 q-mt-lg"},"Create Your DAO",-1),u={class:"q-mb-md text-grey-5 text-h6 text-weight-light"},m={key:0,class:"row justify-between"},d=(0,o.createElementVNode)("div",null,"CREATING A DAO",-1),p=[d],h={key:1,class:"row justify-between"},g=(0,o.createElementVNode)("div",null,"CHOOSE YOUR GROUP NAME",-1),_={key:2,class:"row justify-between"},y=(0,o.createElementVNode)("div",null,"CREATE ACCOUNT",-1),b={key:3,class:"row justify-between"},w=(0,o.createElementVNode)("div",null,"CREATING",-1),f={class:"text-uppercase text-primary"},v=(0,o.createElementVNode)("p",{class:"text-subtitle1"},"Things you'll need to get started:",-1),N=(0,o.createElementVNode)("li",null,[(0,o.createElementVNode)("b",null,"DAO Account Name:"),(0,o.createTextVNode)(" Choose your DAO account name, based on the normal Proton name restrictions (a-z, 1-5, min 4 characters, max 12 characters). Once the DAO has been setup, the account name cannot be changed.")],-1),V=(0,o.createElementVNode)("b",null,"XPR Ready:",-1),x={key:0,class:"text-white text-center bg-secondary q-pa-md rounded-borders"},C=(0,o.createElementVNode)("p",{class:"text-h6 text-center"},"Please login with Anchor",-1),k=(0,o.createElementVNode)("p",{class:"text-center"},[(0,o.createTextVNode)("In order to create a DAO, you must login in Anchor and ensure that "),(0,o.createElementVNode)("br"),(0,o.createElementVNode)("b",null,'"Create a session for future use with this app"'),(0,o.createElementVNode)("br"),(0,o.createTextVNode)(" is selected. ")],-1),E={key:1,class:"row justify-center"},A={class:"rounded-borders overflow-hidden"},q={key:0,class:"text-grey-8 row"},B=(0,o.createElementVNode)("span",null,"Account name available!",-1),D=[B],R={key:1},S={class:"column justify-center items-center q-mt-lg"},T={key:0,class:"q-mt-sm"},O=(0,o.createTextVNode)(" This group isn't activated yet. Proceed to activation by clicking the button. "),$={class:"row justify-begin items-center text-black"},P={class:"text-uppercase"},G=(0,o.createTextVNode)(" Edit Group Name. "),H={class:"text-grey-6"},Z={class:"column justify-center items-center q-mt-md"},j={class:"column items-center full-height text-grey-6 q-pt-md"},W=(0,o.createTextVNode)(" Account created "),z={class:"column items-center full-height text-grey-6 q-pt-md"},Q=(0,o.createElementVNode)("div",{class:"q-mt-md"},"Waiting for Signature",-1),F={class:"column items-center full-height text-grey-6 q-pt-md"},I=(0,o.createElementVNode)("div",{class:"q-mt-xs"},"Group created successful",-1);function U(e,t,a,n,s,c){const d=(0,o.resolveComponent)("login-network-switcher"),B=(0,o.resolveComponent)("q-btn"),U=(0,o.resolveComponent)("q-carousel-slide"),Y=(0,o.resolveComponent)("q-icon"),K=(0,o.resolveComponent)("q-input"),M=(0,o.resolveComponent)("q-tooltip"),L=(0,o.resolveComponent)("q-spinner"),X=(0,o.resolveComponent)("q-carousel"),J=(0,o.resolveComponent)("wasmCompiler");return(0,o.openBlock)(),(0,o.createElementBlock)("div",r,[(0,o.createElementVNode)("div",i,[l,(0,o.createElementVNode)("div",u,["intro"===e.step?((0,o.openBlock)(),(0,o.createElementBlock)("div",m,p)):(0,o.createCommentVNode)("",!0),"request_account_name"===e.step?((0,o.openBlock)(),(0,o.createElementBlock)("div",h,[g,(0,o.createElementVNode)("div",null,"1/"+(0,o.toDisplayString)(e.number_of_steps),1)])):(0,o.createCommentVNode)("",!0),"create_account"===e.step?((0,o.openBlock)(),(0,o.createElementBlock)("div",_,[y,(0,o.createElementVNode)("div",null,"2/"+(0,o.toDisplayString)(e.number_of_steps),1)])):"request_signature"===e.step?((0,o.openBlock)(),(0,o.createElementBlock)("div",b,[w,(0,o.createElementVNode)("div",f,(0,o.toDisplayString)(e.new_group_account_name),1)])):(0,o.createCommentVNode)("",!0)]),(0,o.createVNode)(X,{modelValue:e.step,"onUpdate:modelValue":t[6]||(t[6]=t=>e.step=t),"keep-alive":"",navigation:!1,"transition-prev":"scale","transition-next":"scale",swipeable:!1,animated:"","control-color":"primary",padding:!1,arrows:!1,height:"auto",class:"bg-transparent"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(U,{name:"info",class:"no-padding"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",null,[v,(0,o.createElementVNode)("ul",null,[N,(0,o.createElementVNode)("li",null,[V,(0,o.createTextVNode)(" As part of the setup, you'll need to send "+(0,o.toDisplayString)(e.getResourceEstimation)+" to The DAOScape hub account, so be sure to have that ready to go!",1)])]),e.isValidWallet?((0,o.openBlock)(),(0,o.createElementBlock)("div",E,[(0,o.createVNode)(B,{color:"primary",label:"Get Started",onClick:t[0]||(t[0]=t=>e.step="request_account_name")})])):((0,o.openBlock)(),(0,o.createElementBlock)("div",x,[C,k,(0,o.createVNode)(d)]))])])),_:1}),(0,o.createVNode)(U,{name:"request_account_name",class:"no-padding"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",null,[(0,o.createElementVNode)("div",A,[(0,o.createVNode)(K,{dark:!1,ref:"accountinput",autocomplete:"off",outlined:"","no-error-icon":"",counter:"",maxlength:"12",color:"accent","bg-color":"white",modelValue:e.new_group_account_name,"onUpdate:modelValue":t[1]||(t[1]=t=>e.new_group_account_name=t),placeholder:"Choose new group name",rules:[e=>!!e||"* Required",e.isValidAccountName,e=>e.length>=4||"Group name must be min 4 chars.",e.isavailableAccountNameWrapper],onInput:t[2]||(t[2]=t=>e.account_name_validated=!1)},{prepend:(0,o.withCtx)((()=>[(0,o.createVNode)(Y,{name:"people"})])),append:(0,o.withCtx)((()=>[e.account_name_validated?((0,o.openBlock)(),(0,o.createBlock)(Y,{key:0,name:"check",color:"positive"})):(0,o.createCommentVNode)("",!0)])),hint:(0,o.withCtx)((()=>[e.account_name_validated?((0,o.openBlock)(),(0,o.createElementBlock)("span",q,D)):((0,o.openBlock)(),(0,o.createElementBlock)("span",R,"12 char account name"))])),_:1},8,["modelValue","rules"])]),(0,o.createElementVNode)("div",S,[(0,o.createVNode)(B,{color:"primary",label:"next",style:{width:"150px"},disabled:!e.account_name_validated,onClick:t[3]||(t[3]=t=>e.next(""))},null,8,["disabled"]),e.groups_by_creator.length?((0,o.openBlock)(),(0,o.createElementBlock)("div",T,[(0,o.createVNode)(o.TransitionGroup,{appear:"","enter-active-class":"animated zoomIn","leave-active-class":"animated zoomOut",mode:"out-in",class:"column q-gutter-sm",tag:"div"},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(e.groups_by_creator.filter((e=>0===e.state)),(t=>((0,o.openBlock)(),(0,o.createBlock)(B,{icon:"mdi-alert",label:t.groupname,key:t.groupname,color:"secondary",onClick:a=>e.next(t.groupname)},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(M,{class:"bg-secondary",delay:500},{default:(0,o.withCtx)((()=>[O])),_:1})])),_:2},1032,["label","onClick"])))),128))])),_:1})])):(0,o.createCommentVNode)("",!0)])])])),_:1}),(0,o.createVNode)(U,{name:"create_account",class:"no-padding"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",$,[(0,o.createElementVNode)("span",P,(0,o.toDisplayString)(e.new_group_account_name),1),(0,o.createVNode)(B,{icon:"edit",round:"",flat:"",size:"sm",onClick:t[4]||(t[4]=t=>e.step="request_account_name")},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(M,{delay:300,anchor:"center right",self:"center left",offset:[10,0]},{default:(0,o.withCtx)((()=>[G])),_:1})])),_:1})]),(0,o.createElementVNode)("div",H," The estimated cost to create your account is "+(0,o.toDisplayString)(e.getResourceEstimation)+". Your current DAOScape balance is: "+(0,o.toDisplayString)(e.hubDeposits)+". ",1),(0,o.createElementVNode)("div",Z,[(0,o.createVNode)(B,{color:"primary",label:"Create Account",style:{width:"150px"},disabled:!e.account_name_validated,onClick:e.createGroup},null,8,["disabled","onClick"])])])),_:1}),(0,o.createVNode)(U,{name:"request_activation",class:"no-padding"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",j,[W,(0,o.createVNode)(B,{color:"primary",label:"activate",style:{width:"150px"},onClick:e.activateGroup},null,8,["onClick"])])])),_:1}),(0,o.createVNode)(U,{name:"request_signature",class:"no-padding"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",z,[(0,o.createVNode)(L,{color:"primary",size:"40px",onClick:t[5]||(t[5]=t=>e.step="request_account_name"),class:"cursor-pointer"}),Q])])),_:1}),(0,o.createVNode)(U,{name:"group_created",class:"no-padding"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",F,[(0,o.createVNode)(Y,{color:"primary",size:"40px",name:"check"}),I,(0,o.createVNode)(B,{label:"visit group",color:"secondary",class:"q-mt-md",to:`/manage/${e.new_group_account_name}`},null,8,["to"])])])),_:1})])),_:1},8,["modelValue"])]),(0,o.createVNode)(J,{ref:"wasm_compiler"},null,512)])}a(10071);var Y=a(48860),K=a(44494),M=a(47592),L=a(40019);const X=(0,o.defineComponent)({name:"newGroup",components:{wasmCompiler:Y.Z,loginNetworkSwitcher:K.Z},props:{prefill:{type:Object,default:()=>({group_account_name:""})}},data(){return{number_of_steps:3,step:"info",new_group_account_name:"",account_name_validated:!1,voice_only:!1,wasmhex:"",abihex:"",groups_by_creator:[],required_bytes:192e4}},computed:{...(0,c.Se)({getAccountName:"proton/getAccountName",getAppConfig:"app/getAppConfig",getHubDeposits:"user/getHubDeposits",getRamPricePerByte:"app/getRamPricePerByte",getSession:"proton/getSession"}),getResourceEstimation(){if(this.getRamPricePerByte)return`${(this.getRamPricePerByte*this.required_bytes).toFixed(4)} ${this.getAppConfig.system_token.symbol}`},has_enough_deposits(){let e=!1;if(this.getResourceEstimation&&this.getHubDeposits.length){let e=this.getHubDeposits.find((e=>e.symbol==this.getAppConfig.system_token.symbol)).quantity;if(e)return parseFloat(this.getResourceEstimation)<=parseFloat(e)}return e},hubDeposits(){return this.getHubDeposits.length?`${this.getHubDeposits.find((e=>e.symbol==this.getAppConfig.system_token.symbol)).quantity}`:`0 ${this.getAppConfig.system_token.symbol}`},isValidWallet(){return!!this.getSession&&("anchor"==this.getSession.link.walletType&&"channel"==this.getSession.type)},isWebAuth(){return!!this.getSession&&"proton"==this.getSession.link.walletType}},async mounted(){this.$store.dispatch("app/fetchRamPricePerByte",{vm:this}),await this.get_wasm_and_abi_from_github(),this.prefill.group_account_name&&(this.new_group_account_name=this.prefill.group_account_name)},watch:{new_group_account_name:function(){L.log(this.$refs.accountinput.hasError)},getAccountName:{immediate:!0,handler:function(e,t){this.getAccountName&&this.getGroupsByCreator()}}},methods:{isValidAccountName:M.ZF,isAvailableAccountName:M.Kx,async isavailableAccountNameWrapper(e){const t=await(0,M.Kx)({v:e,vm:this});return!0===t?(this.account_name_validated=!0,!0):(this.account_name_validated=!1,t)},async activateGroup(){this.deploycontract(this.new_group_account_name)},async createGroup(){if(this.has_enough_deposits)try{await this.$store.dispatch("app/fetchRamPricePerByte",{vm:this}),this.step="request_signature";let e={account:this.getAppConfig.groups_contract,name:"creategroup",data:{groupname:this.new_group_account_name,creator:this.getAccountName,resource_estimation:this.getResourceEstimation}},t=await this.$store.dispatch("proton/transact",{actions:[e],disable_signing_overlay:!0});if(setTimeout((()=>{this.$store.dispatch("user/fetchHubDeposits",{accountname:this.getAccountName,vm:this})}),2e3),!t||!t.trxid)return this.step="create_account",!1;this.step="request_activation"}catch(e){L.warn(e)}else this.openHubWallet()},async deploycontract(e){this.step="request_signature";let t={account:"eosio",name:"setcode",data:{account:e,vmtype:0,vmversion:0,code:this.wasmhex},authorization:[{actor:this.getAccountName,permission:"active"},{actor:e,permission:"active"}]},a={account:"eosio",name:"setabi",data:{account:e,abi:this.abihex},authorization:[{actor:this.getAccountName,permission:"active"},{actor:e,permission:"active"}]},o={account:this.getAppConfig.groups_contract,name:"activate",data:{groupname:e,creator:this.getAccountName}},n=await this.$store.dispatch("proton/transact",{actions:[a,t,o],disable_signing_overlay:!0});return setTimeout((()=>{this.$store.dispatch("user/fetchHubDeposits",{accountname:this.getAccountName,vm:this})}),1e3),n&&n.trxid?(this.step="group_created",!0):(this.step="request_activation",!1)},openHubWallet(){let e=`You don't have enough ${this.getAppConfig.system_token.symbol} deposits to start your DAO.\n      You need a minimum of ${this.getResourceEstimation} to deploy the core contract. Excess deposits will be used to buy extra RAM.\n      Once you have deposited the required amount, please close this pop-up and click "Create Account" again.`;this.emitter.emit("showHubDeposits",e)},async next(e=""){""!=e?(this.step="request_activation",this.new_group_account_name=e,this.account_name_validated=!0):(this.step="create_account",this.has_enough_deposits||this.openHubWallet())},async get_wasm_and_abi_from_github(){L.log("retrieving code from github");let e=await this.$refs.wasm_compiler.loadRemoteWasm("https://raw.githubusercontent.com/FreeosDAO/daclifycore/master/daclifycore.wasm"),t=await this.$refs.wasm_compiler.loadRemoteAbi("https://raw.githubusercontent.com/FreeosDAO/daclifycore/master/daclifycore.abi");this.wasmhex=e.wasm,this.abihex=t.abi},async get_wasm_and_abi_from_block(e){let t=[];t.push(this.$eos.api.rpc.get_block(e.wasm[0])),e.wasm[0]!=e.abi[0]&&t.push(this.$eos.api.rpc.get_block(e.abi[0]));let[a,o]=await Promise.all(t);o=o||a;let n=a.transactions.find((t=>t.trx.id==e.wasm[1])).trx.transaction.actions.find((e=>"setcode"==e.name)).data.code,s=o.transactions.find((t=>t.trx.id==e.abi[1])).trx.transaction.actions.find((e=>"setabi"==e.name)).data.abi;this.wasmhex=n,this.abihex=s},async getGroupsByCreator(){let e=await this.$eos.api.rpc.get_table_rows({json:!0,code:this.getAppConfig.groups_contract,scope:this.getAppConfig.groups_contract,table:"groups",key_type:"name",index_position:3,lower_bound:this.getAccountName,upper_bound:this.getAccountName,limit:-1});e=e&&e.rows.length&&e.rows[0].creator==this.getAccountName?e.rows:[],L.log("fetched groups by creator",e),this.groups_by_creator=e}}});var J=a(74260),ee=a(31277),te=a(34593),ae=a(2165),oe=a(64689),ne=a(24554),se=a(5363),ce=a(6833),re=a(7518),ie=a.n(re);const le=(0,J.Z)(X,[["render",U]]),ue=le;ie()(X,"components",{QCarousel:ee.Z,QCarouselSlide:te.Z,QBtn:ae.Z,QInput:oe.Z,QIcon:ne.Z,QTooltip:se.Z,QSpinner:ce.Z});const me=(0,o.defineComponent)({name:"create",components:{newGroup:ue},data(){return{}},computed:{...(0,c.Se)({getAccountName:"proton/getAccountName"})},methods:{},watch:{}});var de=a(24379);const pe=(0,J.Z)(me,[["render",s]]),he=pe;ie()(me,"components",{QPage:de.Z})}}]);